project_name: goreleaser-testing

before:
    hooks:
        - go mod tidy

builds:
    - binary: goreleaser-testing
      env:
          - CGO_ENABLED=0
      goos:
          - darwin
          - freebsd
          - linux
          - windows

archives:
    - name_template: >-
        {{ .ProjectName }}_{{ .Version }}_
        {{- if eq .Os "darwin" }}Darwin
        {{- else if eq .Os "linux" }}Linux
        {{- else if eq .Os "windows" }}Windows
        {{- else }}{{ .Os }}{{ end }}_
        {{- if eq .Arch "amd64" }}x86_64
        {{- else if eq .Arch "386" }}i386
        {{- else }}{{ .Arch }}{{ end }}

checksum:
    name_template: 'checksums.txt'

snapshot:
    name_template: "{{ incpatch .Version }}-next"

changelog:
    sort: asc
    filters:
        exclude:
            - '^docs:'
            - '^test:'

universal_binaries:
    - replace: true

release:
    github:
        owner: robinovitch61
        name: goreleaser-testing

brews:
    - name: goreleaser-testing
      homepage: https://github.com/robinovitch61/goreleaser-testing
      description: "Goreleaser testing description"
      folder: Formula
      commit_author:
          name: goreleaserbot
          email: goreleaserbot@theleo.zone
      commit_msg_template: "Brew formula update for {{ .ProjectName }} version {{ .Tag }}"
      repository:
          owner: robinovitch61
          name: homebrew-tap
          branch: main
          token: "{{ .Env.HOMEBREW_TAP_GITHUB_TOKEN }}"

gomod:
    # Proxy a module from proxy.golang.org, making the builds verifiable.
    # This will only be effective if running against a tag. Snapshots will ignore
    # this setting.
    # Notice: for this to work your `build.main` must be a package, not a `.go` file.
    proxy: true
